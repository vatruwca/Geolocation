!function(){"use strict";class t{constructor(){this.latitude=null,this.longitude=null}static parseInput(t){return t.match(/(-?\d+)/gm)}static collectDecimal(t,e){const i=Number(t),s=Number(e)/10**e.length;return i<0||0===i&&"-"===t.charAt(0)?i-s:i+s}static parseCheck(e){return e&&4===e.length?Number(e[1])<0||Number(e[3]<0)?{result:!1,err:"Дробная часть не может быть отрицательной"}:(this.latitude=t.collectDecimal(e[0],e[1]),this.longitude=t.collectDecimal(e[2],e[3]),this.latitude>90?{result:!1,err:"Широта не может быть больше 90"}:this.latitude<-90?{result:!1,err:"Широта не может быть меньше -90"}:this.longitude>180?{result:!1,err:"Долгота не может быть больше 180"}:this.longitude<-180?{result:!1,err:"Долгота не может быть меньше -180"}:{result:!0,latitude:this.latitude,longitude:this.longitude}):{result:!1,err:"Введите 2 числа с целой и дробной частью"}}}class e{constructor(t,e){this.parentEl=t,this.formCallbacks=e}init(){this.form=document.querySelector(".geoPopup__form"),this.errorMessage=document.querySelector(".geoPopup__error"),this.input=document.querySelector(".geoPopup__input"),this.popup=document.querySelector(".timeline__geoPopup"),this.cancelButton=document.querySelector(".geoPopup__cancelButton"),this.initListeners()}initListeners(){this.form.addEventListener("submit",(t=>{t.preventDefault(),this.onSubmit()})),this.input.addEventListener("input",(t=>{t.preventDefault(),this.hideErrorMessage()})),this.cancelButton.addEventListener("click",(t=>{t.preventDefault(),this.closePopup()}))}onSubmit(){const e=t.parseInput(this.input.value),i=t.parseCheck(e);i.result?(this.formCallbacks.validInputCoord(i.latitude,i.longitude),this.form.reset()):this.showErrorMessage(i.err)}closePopup(){this.popup.classList.remove("active"),this.popup.classList.add("hidden")}showErrorMessage(t){this.errorMessage.innerText=t,this.errorMessage.style.height=`${this.errorMessage.scrollHeight}px`,this.errorMessage.style.marginBottom="10px"}hideErrorMessage(){this.errorMessage.style.height=0,this.errorMessage.style.marginBottom=0}}(new class{constructor(){this.input=null,this.container=null,this.form=null,this.popup=null}init(){this.input=document.querySelector(".control__text"),this.container=document.querySelector(".timeline__content"),this.form=document.querySelector(".form__input"),this.popup=document.querySelector(".timeline__geoPopup"),this.geoPopup=new e(this.popup,{validInputCoord:this.validInputCoord.bind(this)}),this.geoPopup.init(),this.initListener()}initListener(){this.form.addEventListener("submit",(t=>{t.preventDefault(),this.geoPermission()}))}createCard(){const t=document.createElement("div");t.classList.add("text__element");const e=document.createElement("div");e.classList.add("text__element_content"),e.textContent=this.input.value;const i=Date(),s=document.createElement("div");var o;s.classList.add("text__element_date"),s.textContent=`${(o=i).substring(8,10)} ${o.substring(4,7)} ${o.substring(11,15)} ${o.substring(16,18)}:${o.substring(19,21)}:${o.substring(22,24)}`;const n=this.latitude>=0?"N: ":"S: ",r=this.longitude>=0?"E: ":"W: ",u=document.createElement("div");u.classList.add("text__coords"),u.innerHTML=`\n          <div class="text__coords_lat">\n              <span>${n}</span>\n              <span>${Math.abs(this.latitude)}</span>\n          </div>\n          <div class="text__coords_lon">\n              <span>${r}</span>\n              <span>${Math.abs(this.longitude)}</span>\n          </div>`,t.appendChild(e),t.appendChild(s),t.appendChild(u),this.input.value="",this.container.append(t)}showPopup(){this.popup.classList.remove("hidden"),this.popup.classList.add("active")}validInputCoord(t,e){this.latitude=t,this.longitude=e,this.createCard(),this.hidePopup()}hidePopup(){this.popup.classList.remove("active"),this.popup.classList.add("hidden")}reset(){this.form.reset(),this.latitude=null,this.longitude=null}positionDetected(t){this.latitude=t.coords.latitude,this.longitude=t.coords.longitude,this.createCard()}positionError(){this.showPopup()}geoPermission(){navigator.geolocation?navigator.geolocation.getCurrentPosition(this.positionDetected.bind(this),this.positionError.bind(this)):this.positionError()}}).init()}();